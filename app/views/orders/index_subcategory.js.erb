function addsubcategoryAtSession(){
	// @category @subcategory @index format int
	let inArray = [<%= @subcategory.id %>,"<%= @subcategory.name %>",<%= @subcategory.price %>]
	let sessionPrestation = JSON.parse(sessionStorage.getItem("prestations"))
	
	for (var j = sessionPrestation.length - 1; j >= 0; j--) {
		if(sessionPrestation[j].id == <%= @index %>){
			var indexTab = j
			break
		}
	}
	
	// Récuperer la liste de tous les prestations
	let	listPrestation = sessionPrestation[indexTab].prestation
	if(listPrestation.length == 0){
		sessionPrestation[indexTab].prestation.push(inArray)
		sessionStorage.setItem("prestations",JSON.stringify(sessionPrestation))
	}else{
		// Vérifier si l'element est déjat dans le tableau
		for ( var i = 0; i < listPrestation.length ; i++ ) {
		    if ( listPrestation[i][0] === inArray[0] ) {
		        var index_array = i
		        break;
		    }
		}
		// Si la sous-category est déjat à l'intérieur
		if(index_array != undefined){ // Suppression de l'element
			listPrestation.splice(index_array,1)
			sessionPrestation[indexTab].prestation = listPrestation
			sessionStorage.setItem("prestations",JSON.stringify(sessionPrestation))
		}else{ // Si non!
			sessionPrestation[indexTab].prestation.push(inArray)
			sessionStorage.setItem("prestations",JSON.stringify(sessionPrestation))
		}
	}
	// Une fonction pour calculer les prix d'une category
	calculPrice(sessionPrestation[indexTab].prestation);
}

function addSubcategoryAtDom(){
	let ul = document.getElementById("list-card-<%= @category.name %>-<%= @index %>")

	let li = document.getElementById("posibilities-<%= @subcategory.name %>-<%= @index %>")
	if (li){
		li.remove()
	}else{
		let list = document.createElement("li")
		list.setAttribute("id","posibilities-<%= @subcategory.name %>-<%= @index %>") // pour la relation label input
		list.innerHTML = "<%= @subcategory.name %>"
		ul.appendChild(list)
	}
}

function calculPrice(arrayOfPrestation){
	let price = 0
	for (var i = arrayOfPrestation.length - 1; i >= 0; i--) {
		price += arrayOfPrestation[i][2]
	}
	document.getElementById("price-<%= @index %>").innerHTML = price.toFixed(2)
}

function totalPrice(){
	let sessionPrestation = JSON.parse(sessionStorage.getItem("prestations"))

	let prixTotal = 0
	for (var i = 0 ; i < sessionPrestation.length ; i++) {
		let prestations = sessionPrestation[i].prestation
		for (var g = 0 ; g < prestations.length ; g++) {
			prixTotal += prestations[g][2]
		}
	}

	let sessionProduits = JSON.parse(sessionStorage.getItem("products"))
	for (var i = 0 ; i < sessionProduits.length ; i++) {
		prixTotal += sessionProduits[i].list[2]
	}
	document.getElementById("priceTotale").innerHTML = prixTotal.toFixed(2)
}

addsubcategoryAtSession()
addSubcategoryAtDom()
totalPrice()
